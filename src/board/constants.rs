pub const KNIGHTS_ATTACK_TABLE: [u64; 64] = [
    0x0000000000020400,
    0x0000000000050800,
    0x00000000000a1100,
    0x0000000000142200,
    0x0000000000284400,
    0x0000000000508800,
    0x0000000000a01000,
    0x0000000000402000,
    0x0000000002040004,
    0x0000000005080008,
    0x000000000a110011,
    0x0000000014220022,
    0x0000000028440044,
    0x0000000050880088,
    0x00000000a0100010,
    0x0000000040200020,
    0x0000000204000402,
    0x0000000508000805,
    0x0000000a1100110a,
    0x0000001422002214,
    0x0000002844004428,
    0x0000005088008850,
    0x000000a0100010a0,
    0x0000004020002040,
    0x0000020400040200,
    0x0000050800080500,
    0x00000a1100110a00,
    0x0000142200221400,
    0x0000284400442800,
    0x0000508800885000,
    0x0000a0100010a000,
    0x0000402000204000,
    0x0002040004020000,
    0x0005080008050000,
    0x000a1100110a0000,
    0x0014220022140000,
    0x0028440044280000,
    0x0050880088500000,
    0x00a0100010a00000,
    0x0040200020400000,
    0x0204000402000000,
    0x0508000805000000,
    0x0a1100110a000000,
    0x1422002214000000,
    0x2844004428000000,
    0x5088008850000000,
    0xa0100010a0000000,
    0x4020002040000000,
    0x0400040200000000,
    0x0800080500000000,
    0x1100110a00000000,
    0x2200221400000000,
    0x4400442800000000,
    0x8800885000000000,
    0x100010a000000000,
    0x2000204000000000,
    0x0004020000000000,
    0x0008050000000000,
    0x00110a0000000000,
    0x0022140000000000,
    0x0044280000000000,
    0x0088500000000000,
    0x0010a00000000000,
    0x0020400000000000,
]; //

pub const KING_ATTACK_TABLE: [u64; 64] = [
    0x0000000000000302,
    0x0000000000000705,
    0x0000000000000e0a,
    0x0000000000001c14,
    0x0000000000003828,
    0x0000000000007050,
    0x000000000000e0a0,
    0x000000000000c040,
    0x0000000000030203,
    0x0000000000070507,
    0x00000000000e0a0e,
    0x00000000001c141c,
    0x0000000000382838,
    0x0000000000705070,
    0x0000000000e0a0e0,
    0x0000000000c040c0,
    0x0000000003020300,
    0x0000000007050700,
    0x000000000e0a0e00,
    0x000000001c141c00,
    0x0000000038283800,
    0x0000000070507000,
    0x00000000e0a0e000,
    0x00000000c040c000,
    0x0000000302030000,
    0x0000000705070000,
    0x0000000e0a0e0000,
    0x0000001c141c0000,
    0x0000003828380000,
    0x0000007050700000,
    0x000000e0a0e00000,
    0x000000c040c00000,
    0x0000030203000000,
    0x0000070507000000,
    0x00000e0a0e000000,
    0x00001c141c000000,
    0x0000382838000000,
    0x0000705070000000,
    0x0000e0a0e0000000,
    0x0000c040c0000000,
    0x0003020300000000,
    0x0007050700000000,
    0x000e0a0e00000000,
    0x001c141c00000000,
    0x0038283800000000,
    0x0070507000000000,
    0x00e0a0e000000000,
    0x00c040c000000000,
    0x0302030000000000,
    0x0705070000000000,
    0x0e0a0e0000000000,
    0x1c141c0000000000,
    0x3828380000000000,
    0x7050700000000000,
    0xe0a0e00000000000,
    0xc040c00000000000,
    0x0203000000000000,
    0x0507000000000000,
    0x0a0e000000000000,
    0x141c000000000000,
    0x2838000000000000,
    0x5070000000000000,
    0xa0e0000000000000,
    0x40c0000000000000,
]; //

pub const WHITE_PAWN_ATTACKS: [u64; 64] = [
    // Rank 1 (Indices 0-7) - No pawns here
    0x0000000000000200, // A1 → B2
    0x0000000000000500, // B1 → A2, C2
    0x0000000000000A00, // C1 → B2, D2
    0x0000000000001400, // D1 → C2, E2
    0x0000000000002800, // E1 → D2, F2
    0x0000000000005000, // F1 → E2, G2
    0x000000000000A000, // G1 → F2, H2
    0x0000000000004000, // H1 → G2
    // Rank 2 (Indices 8-15)
    0x0000000000020000,
    0x0000000000050000,
    0x00000000000a0000,
    0x0000000000140000,
    0x0000000000280000,
    0x0000000000500000,
    0x0000000000a00000,
    0x0000000000400000,
    // Rank 3 (Indices 16-23)
    0x0000000002000000,
    0x0000000005000000,
    0x000000000a000000,
    0x0000000014000000,
    0x0000000028000000,
    0x0000000050000000,
    0x00000000a0000000,
    0x0000000040000000,
    // Rank 4 (Indices 24-31)
    0x0000000200000000,
    0x0000000500000000,
    0x0000000a00000000,
    0x0000001400000000,
    0x0000002800000000,
    0x0000005000000000,
    0x000000a000000000,
    0x0000004000000000,
    // Rank 5 (Indices 32-39)
    0x0000020000000000,
    0x0000050000000000,
    0x00000a0000000000,
    0x0000140000000000,
    0x0000280000000000,
    0x0000500000000000,
    0x0000a00000000000,
    0x0000400000000000,
    // Rank 6 (Indices 40-47)
    0x0002000000000000,
    0x0005000000000000,
    0x000a000000000000,
    0x0014000000000000,
    0x0028000000000000,
    0x0050000000000000,
    0x00a0000000000000,
    0x0040000000000000,
    // Rank 7 (Indices 48-55)
    0x0200000000000000,
    0x0500000000000000,
    0x0a00000000000000,
    0x1400000000000000,
    0x2800000000000000,
    0x5000000000000000,
    0xa000000000000000,
    0x4000000000000000,
    // Rank 8 (Indices 56-63) - Pawns promote, usually 0 attacks
    0x0000000000000000,
    0x0000000000000000,
    0x0000000000000000,
    0x0000000000000000,
    0x0000000000000000,
    0x0000000000000000,
    0x0000000000000000,
    0x0000000000000000,
];

pub const BLACK_PAWN_ATTACKS: [u64; 64] = [
    // Rank 1 (Indices 0-7) - Pawns promote, usually 0 attacks
    0x0000000000000000,
    0x0000000000000000,
    0x0000000000000000,
    0x0000000000000000,
    0x0000000000000000,
    0x0000000000000000,
    0x0000000000000000,
    0x0000000000000000,
    // Rank 2 (Indices 8-15)
    0x0000000000000002,
    0x0000000000000005,
    0x000000000000000a,
    0x0000000000000014,
    0x0000000000000028,
    0x0000000000000050,
    0x00000000000000a0,
    0x0000000000000040,
    // Rank 3 (Indices 16-23)
    0x0000000000000200,
    0x0000000000000500,
    0x0000000000000a00,
    0x0000000000001400,
    0x0000000000002800,
    0x0000000000005000,
    0x000000000000a000,
    0x0000000000004000,
    // Rank 4 (Indices 24-31)
    0x0000000000020000,
    0x0000000000050000,
    0x00000000000a0000,
    0x0000000000140000,
    0x0000000000280000,
    0x0000000000500000,
    0x0000000000a00000,
    0x0000000000400000,
    // Rank 5 (Indices 32-39)
    0x0000000002000000,
    0x0000000005000000,
    0x000000000a000000,
    0x0000000014000000,
    0x0000000028000000,
    0x0000000050000000,
    0x00000000a0000000,
    0x0000000040000000,
    // Rank 6 (Indices 40-47)
    0x0000000200000000,
    0x0000000500000000,
    0x0000000a00000000,
    0x0000001400000000,
    0x0000002800000000,
    0x0000005000000000,
    0x000000a000000000,
    0x0000004000000000,
    // Rank 7 (Indices 48-55)
    0x0000020000000000,
    0x0000050000000000,
    0x00000a0000000000,
    0x0000140000000000,
    0x0000280000000000,
    0x0000500000000000,
    0x0000a00000000000,
    0x0000400000000000,
    // Rank 8 (Indices 56-63) - No pawns here
    0x0002000000000000, // A8 → B7
    0x0005000000000000, // B8 → A7, C7
    0x000A000000000000, // C8 → B7, D7
    0x0014000000000000, // D8 → C7, E7
    0x0028000000000000, // E8 → D7, F7
    0x0050000000000000, // F8 → E7, G7
    0x00A0000000000000, // G8 → F7, H7
    0x0040000000000000, // H8 → G7
];

pub const RANK_3: u64 = 0x0000000000FF0000;
pub const RANK_4: u64 = 0x00000000FF000000;
pub const RANK_5: u64 = 0x000000FF00000000;
pub const RANK_6: u64 = 0x0000FF0000000000;
pub const RANK_2: u64 = 0x000000000000FF00;
pub const RANK_7: u64 = 0x00FF000000000000;
pub const RANK_8: u64 = 0xFF00000000000000;
pub const RANK_1: u64 = 0x00000000000000FF;


pub const MVV_LVA: [[i32; 6]; 6] = [
    // victim ↓ , attacker →
    //P   N   B   R   Q   K
    [105,104,103,102,101,100], // Pawn
    [205,204,203,202,201,200], // Knight
    [305,304,303,302,301,300], // Bishop
    [405,404,403,402,401,400], // Rook
    [505,504,503,502,501,500], // Queen
    [605,604,603,602,601,600], // King
];


pub const MG_PAWN_TABLE: [i32; 64] = [
    0,   0,   0,   0,   0,   0,  0,   0,
    98, 134,  61,  95,  68, 126, 34, -11,
    -6,   7,  26,  31,  65,  56, 25, -20,
    -14,  13,   6,  21,  23,  12, 17, -23,
    -27,  -2,  -5,  12,  17,   6, 10, -25,
    -26,  -4,  -4, -10,   3,   3, 33, -12,
    -35,  -1, -20, -23, -15,  24, 38, -22,
    0,   0,   0,   0,   0,   0,  0,   0,
];

pub const EG_PAWN_TABLE: [i32; 64] = [
      0,   0,   0,   0,   0,   0,   0,   0,
    178, 173, 158, 134, 147, 132, 165, 187,
     94, 100,  85,  67,  56,  53,  82,  84,
     32,  24,  13,   5,  -2,   4,  17,  17,
     13,   9,  -3,  -7,  -7,  -8,   3,  -1,
      4,   7,  -6,   1,   0,  -5,  -1,  -8,
     13,   8,   8,  10,  13,   0,   2,  -7,
      0,   0,   0,   0,   0,   0,   0,   0,
];

pub const MG_KNIGHT_TABLE: [i32; 64] = [
    -167, -89, -34, -49,  61, -97, -15, -107,
     -73, -41,  72,  36,  23,  62,   7,  -17,
     -47,  60,  37,  65,  84, 129,  73,   44,
      -9,  17,  19,  53,  37,  69,  18,   22,
     -13,   4,  16,  13,  28,  19,  21,   -8,
     -23,  -9,  12,  10,  19,  17,  25,  -16,
     -29, -53, -12,  -3,  -1,  18, -14,  -19,
    -105, -21, -58, -33, -17, -28, -19,  -23,
];

pub const EG_KNIGHT_TABLE: [i32; 64] = [
    -58, -38, -13, -28, -31, -27, -63, -99,
    -25,  -8, -25,  -2,  -9, -25, -24, -52,
    -24, -20,  10,   9,  -1,  -9, -19, -41,
    -17,   3,  22,  22,  22,  11,   8, -18,
    -18,  -6,  16,  25,  16,  17,   4, -18,
    -23,  -3,  -1,  15,  10,  -3, -20, -22,
    -42, -20, -10,  -5,  -2, -20, -23, -44,
    -29, -51, -23, -15, -22, -18, -50, -64,
];

pub const MG_BISHOP_TABLE: [i32; 64] = [
    -29,   4, -82, -37, -25, -42,   7,  -8,
    -26,  16, -18, -13,  30,  59,  18, -47,
    -16,  37,  43,  40,  35,  50,  37,  -2,
     -4,   5,  19,  50,  37,  37,   7,  -2,
     -6,  13,  13,  26,  34,  12,  10,   4,
      0,  15,  15,  15,  14,  27,  18,  10,
      4,  15,  16,   0,   7,  21,  33,   1,
    -33,  -3, -14, -21, -13, -12, -39, -21,
];


pub const EG_BISHOP_TABLE: [i32; 64] = [
    -14, -21, -11,  -8, -7,  -9, -17, -24,
     -8,  -4,   7, -12, -3, -13,  -4, -14,
      2,  -8,   0,  -1, -2,   6,   0,   4,
     -3,   9,  12,   9, 14,  10,   3,   2,
     -6,   3,  13,  19,  7,  10,  -3,  -9,
    -12,  -3,   8,  10, 13,   3,  -7, -15,
    -14, -18,  -7,  -1,  4,  -9, -15, -27,
    -23,  -9, -23,  -5, -9, -16,  -5, -17,
];


pub const MG_ROOK_TABLE: [i32; 64] = [
     32,  42,  32,  51, 63,  9,  31,  43,
     27,  32,  58,  62, 80, 67,  26,  44,
     -5,  19,  26,  36, 17, 45,  61,  16,
    -24, -11,   7,  26, 24, 35,  -8, -20,
    -36, -26, -12,  -1,  9, -7,   6, -23,
    -45, -25, -16, -17,  3,  0,  -5, -33,
    -44, -16, -20,  -9, -1, 11,  -6, -71,
    -19, -13,   1,  17, 16,  7, -37, -26,
];


pub const EG_ROOK_TABLE: [i32; 64] = [
    13, 10, 18, 15, 12,  12,   8,   5,
    11, 13, 13, 11, -3,   3,   8,   3,
     7,  7,  7,  5,  4,  -3,  -5,  -3,
     4,  3, 13,  1,  2,   1,  -1,   2,
     3,  5,  8,  4, -5,  -6,  -8, -11,
    -4,  0, -5, -1, -7, -12,  -8, -16,
    -6, -6,  0,  2, -9,  -9, -11,  -3,
    -9,  2,  3, -1, -5, -13,   4, -20,
];


pub const MG_QUEEN_TABLE: [i32; 64] = [
    -28,   0,  29,  12,  59,  44,  43,  45,
    -24, -39,  -5,   1, -16,  57,  28,  54,
    -13, -17,   7,   8,  29,  56,  47,  57,
    -27, -27, -16, -16,  -1,  17,  -2,   1,
     -9, -26,  -9, -10,  -2,  -4,   3,  -3,
    -14,   2, -11,  -2,  -5,   2,  14,   5,
    -35,  -8,  11,   2,   8,  15,  -3,   1,
     -1, -18,  -9,  10, -15, -25, -31, -50,
];


pub const EG_QUEEN_TABLE: [i32; 64] = [
     -9,  22,  22,  27,  27,  19,  10,  20,
    -17,  20,  32,  41,  58,  25,  30,   0,
    -20,   6,   9,  49,  47,  35,  19,   9,
      3,  22,  24,  45,  57,  40,  57,  36,
    -18,  28,  19,  47,  31,  34,  39,  23,
    -16, -27,  15,   6,   9,  17,  10,   5,
    -22, -23, -30, -16, -16, -23, -36, -32,
    -33, -28, -22, -43,  -5, -32, -20, -41,
];


pub const MG_KING_TABLE: [i32; 64] = [
    -65,  23,  16, -15, -56, -34,   2,  13,
     29,  -1, -20,  -7,  -8,  -4, -38, -29,
     -9,  24,   2, -16, -20,   6,  22, -22,
    -17, -20, -12, -27, -30, -25, -14, -36,
    -49,  -1, -27, -39, -46, -44, -33, -51,
    -14, -14, -22, -46, -44, -30, -15, -27,
      1,   7,  -8, -64, -43, -16,   9,   8,
    -15,  36,  12, -54,   8, -28,  24,  14,
];


pub const EG_KING_TABLE: [i32; 64] = [
    -74, -35, -18, -18, -11,  15,   4, -17,
    -12,  17,  14,  17,  17,  38,  23,  11,
     10,  17,  23,  15,  20,  45,  44,  13,
     -8,  22,  24,  27,  26,  33,  26,   3,
    -18,  -4,  21,  24,  27,  23,   9, -11,
    -19,  -3,  11,  21,  23,  16,   7,  -9,
    -27, -11,   4,  13,  14,   4,  -5, -17,
    -53, -34, -21, -11, -28, -14, -24, -43
];

const fn flip(sq: usize) -> usize {
    sq ^ 56
}


const fn build_phase(
    pawn:   &[i32; 64],
    knight:&[i32; 64],
    bishop:&[i32; 64],
    rook:  &[i32; 64],
    queen: &[i32; 64],
    king:  &[i32; 64],
) -> [[i32; 64]; 12] {
    let mut out = [[0; 64]; 12];
    let mut sq = 0;

    while sq < 64 {
        // White pieces (0..5), flipped
        out[0][sq] = pawn  [flip(sq)];
        out[1][sq] = knight[flip(sq)];
        out[2][sq] = bishop[flip(sq)];
        out[3][sq] = rook  [flip(sq)];
        out[4][sq] = queen [flip(sq)];
        out[5][sq] = king  [flip(sq)];

        // Black pieces (6..11), normal + negated
        out[6][sq]  = -pawn  [sq];
        out[7][sq]  = -knight[sq];
        out[8][sq]  = -bishop[sq];
        out[9][sq]  = -rook  [sq];
        out[10][sq] = -queen [sq];
        out[11][sq] = -king  [sq];

        sq += 1;
    }

    out
}

pub static PST: [[[i32; 64]; 12]; 2] = [
    build_phase(
        &MG_PAWN_TABLE,
        &MG_KNIGHT_TABLE,
        &MG_BISHOP_TABLE,
        &MG_ROOK_TABLE,
        &MG_QUEEN_TABLE,
        &MG_KING_TABLE,
    ),
    build_phase(
        &EG_PAWN_TABLE,
        &EG_KNIGHT_TABLE,
        &EG_BISHOP_TABLE,
        &EG_ROOK_TABLE,
        &EG_QUEEN_TABLE,
        &EG_KING_TABLE,
    ),
];


pub static IS_STOP: std::sync::atomic::AtomicBool = std::sync::atomic::AtomicBool::new(false);
