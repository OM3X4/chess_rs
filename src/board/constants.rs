pub const KNIGHTS_ATTACK_TABLE: [u64; 64] = [
    0x0000000000020400,
    0x0000000000050800,
    0x00000000000a1100,
    0x0000000000142200,
    0x0000000000284400,
    0x0000000000508800,
    0x0000000000a01000,
    0x0000000000402000,
    0x0000000002040004,
    0x0000000005080008,
    0x000000000a110011,
    0x0000000014220022,
    0x0000000028440044,
    0x0000000050880088,
    0x00000000a0100010,
    0x0000000040200020,
    0x0000000204000402,
    0x0000000508000805,
    0x0000000a1100110a,
    0x0000001422002214,
    0x0000002844004428,
    0x0000005088008850,
    0x000000a0100010a0,
    0x0000004020002040,
    0x0000020400040200,
    0x0000050800080500,
    0x00000a1100110a00,
    0x0000142200221400,
    0x0000284400442800,
    0x0000508800885000,
    0x0000a0100010a000,
    0x0000402000204000,
    0x0002040004020000,
    0x0005080008050000,
    0x000a1100110a0000,
    0x0014220022140000,
    0x0028440044280000,
    0x0050880088500000,
    0x00a0100010a00000,
    0x0040200020400000,
    0x0204000402000000,
    0x0508000805000000,
    0x0a1100110a000000,
    0x1422002214000000,
    0x2844004428000000,
    0x5088008850000000,
    0xa0100010a0000000,
    0x4020002040000000,
    0x0400040200000000,
    0x0800080500000000,
    0x1100110a00000000,
    0x2200221400000000,
    0x4400442800000000,
    0x8800885000000000,
    0x100010a000000000,
    0x2000204000000000,
    0x0004020000000000,
    0x0008050000000000,
    0x00110a0000000000,
    0x0022140000000000,
    0x0044280000000000,
    0x0088500000000000,
    0x0010a00000000000,
    0x0020400000000000,
]; //

pub const KING_ATTACK_TABLE: [u64; 64] = [
    0x0000000000000302,
    0x0000000000000705,
    0x0000000000000e0a,
    0x0000000000001c14,
    0x0000000000003828,
    0x0000000000007050,
    0x000000000000e0a0,
    0x000000000000c040,
    0x0000000000030203,
    0x0000000000070507,
    0x00000000000e0a0e,
    0x00000000001c141c,
    0x0000000000382838,
    0x0000000000705070,
    0x0000000000e0a0e0,
    0x0000000000c040c0,
    0x0000000003020300,
    0x0000000007050700,
    0x000000000e0a0e00,
    0x000000001c141c00,
    0x0000000038283800,
    0x0000000070507000,
    0x00000000e0a0e000,
    0x00000000c040c000,
    0x0000000302030000,
    0x0000000705070000,
    0x0000000e0a0e0000,
    0x0000001c141c0000,
    0x0000003828380000,
    0x0000007050700000,
    0x000000e0a0e00000,
    0x000000c040c00000,
    0x0000030203000000,
    0x0000070507000000,
    0x00000e0a0e000000,
    0x00001c141c000000,
    0x0000382838000000,
    0x0000705070000000,
    0x0000e0a0e0000000,
    0x0000c040c0000000,
    0x0003020300000000,
    0x0007050700000000,
    0x000e0a0e00000000,
    0x001c141c00000000,
    0x0038283800000000,
    0x0070507000000000,
    0x00e0a0e000000000,
    0x00c040c000000000,
    0x0302030000000000,
    0x0705070000000000,
    0x0e0a0e0000000000,
    0x1c141c0000000000,
    0x3828380000000000,
    0x7050700000000000,
    0xe0a0e00000000000,
    0xc040c00000000000,
    0x0203000000000000,
    0x0507000000000000,
    0x0a0e000000000000,
    0x141c000000000000,
    0x2838000000000000,
    0x5070000000000000,
    0xa0e0000000000000,
    0x40c0000000000000,
]; //

// Standard Little-Endian Rank-File Mapping (A1=0, H8=63)

pub const WHITE_PAWN_ATTACKS: [u64; 64] = [
    // Rank 1 (Indices 0-7) - No pawns here
    0x0000000000000200, // A1 → B2
    0x0000000000000500, // B1 → A2, C2
    0x0000000000000A00, // C1 → B2, D2
    0x0000000000001400, // D1 → C2, E2
    0x0000000000002800, // E1 → D2, F2
    0x0000000000005000, // F1 → E2, G2
    0x000000000000A000, // G1 → F2, H2
    0x0000000000004000, // H1 → G2
    // Rank 2 (Indices 8-15)
    0x0000000000020000,
    0x0000000000050000,
    0x00000000000a0000,
    0x0000000000140000,
    0x0000000000280000,
    0x0000000000500000,
    0x0000000000a00000,
    0x0000000000400000,
    // Rank 3 (Indices 16-23)
    0x0000000002000000,
    0x0000000005000000,
    0x000000000a000000,
    0x0000000014000000,
    0x0000000028000000,
    0x0000000050000000,
    0x00000000a0000000,
    0x0000000040000000,
    // Rank 4 (Indices 24-31)
    0x0000000200000000,
    0x0000000500000000,
    0x0000000a00000000,
    0x0000001400000000,
    0x0000002800000000,
    0x0000005000000000,
    0x000000a000000000,
    0x0000004000000000,
    // Rank 5 (Indices 32-39)
    0x0000020000000000,
    0x0000050000000000,
    0x00000a0000000000,
    0x0000140000000000,
    0x0000280000000000,
    0x0000500000000000,
    0x0000a00000000000,
    0x0000400000000000,
    // Rank 6 (Indices 40-47)
    0x0002000000000000,
    0x0005000000000000,
    0x000a000000000000,
    0x0014000000000000,
    0x0028000000000000,
    0x0050000000000000,
    0x00a0000000000000,
    0x0040000000000000,
    // Rank 7 (Indices 48-55)
    0x0200000000000000,
    0x0500000000000000,
    0x0a00000000000000,
    0x1400000000000000,
    0x2800000000000000,
    0x5000000000000000,
    0xa000000000000000,
    0x4000000000000000,
    // Rank 8 (Indices 56-63) - Pawns promote, usually 0 attacks
    0x0000000000000000,
    0x0000000000000000,
    0x0000000000000000,
    0x0000000000000000,
    0x0000000000000000,
    0x0000000000000000,
    0x0000000000000000,
    0x0000000000000000,
];

pub const BLACK_PAWN_ATTACKS: [u64; 64] = [
    // Rank 1 (Indices 0-7) - Pawns promote, usually 0 attacks
    0x0000000000000000,
    0x0000000000000000,
    0x0000000000000000,
    0x0000000000000000,
    0x0000000000000000,
    0x0000000000000000,
    0x0000000000000000,
    0x0000000000000000,
    // Rank 2 (Indices 8-15)
    0x0000000000000002,
    0x0000000000000005,
    0x000000000000000a,
    0x0000000000000014,
    0x0000000000000028,
    0x0000000000000050,
    0x00000000000000a0,
    0x0000000000000040,
    // Rank 3 (Indices 16-23)
    0x0000000000000200,
    0x0000000000000500,
    0x0000000000000a00,
    0x0000000000001400,
    0x0000000000002800,
    0x0000000000005000,
    0x000000000000a000,
    0x0000000000004000,
    // Rank 4 (Indices 24-31)
    0x0000000000020000,
    0x0000000000050000,
    0x00000000000a0000,
    0x0000000000140000,
    0x0000000000280000,
    0x0000000000500000,
    0x0000000000a00000,
    0x0000000000400000,
    // Rank 5 (Indices 32-39)
    0x0000000002000000,
    0x0000000005000000,
    0x000000000a000000,
    0x0000000014000000,
    0x0000000028000000,
    0x0000000050000000,
    0x00000000a0000000,
    0x0000000040000000,
    // Rank 6 (Indices 40-47)
    0x0000000200000000,
    0x0000000500000000,
    0x0000000a00000000,
    0x0000001400000000,
    0x0000002800000000,
    0x0000005000000000,
    0x000000a000000000,
    0x0000004000000000,
    // Rank 7 (Indices 48-55)
    0x0000020000000000,
    0x0000050000000000,
    0x00000a0000000000,
    0x0000140000000000,
    0x0000280000000000,
    0x0000500000000000,
    0x0000a00000000000,
    0x0000400000000000,
    // Rank 8 (Indices 56-63) - No pawns here
    0x0002000000000000, // A8 → B7
    0x0005000000000000, // B8 → A7, C7
    0x000A000000000000, // C8 → B7, D7
    0x0014000000000000, // D8 → C7, E7
    0x0028000000000000, // E8 → D7, F7
    0x0050000000000000, // F8 → E7, G7
    0x00A0000000000000, // G8 → F7, H7
    0x0040000000000000, // H8 → G7
];

const fn get_queen_rays_inclusive(sq: usize) -> u64 {
    // Start with the bit for the square itself set to 1
    let mut attacks = 1u64 << sq;

    let r = (sq / 8) as i8;
    let f = (sq % 8) as i8;

    // Directions: (rank_change, file_change)
    // N, S, E, W, NE, NW, SE, SW
    let directions = [
        (1, 0),
        (-1, 0),
        (0, 1),
        (0, -1),
        (1, 1),
        (1, -1),
        (-1, 1),
        (-1, -1),
    ];

    let mut i = 0;
    while i < 8 {
        let (dr, df) = directions[i];
        let mut n_r = r + dr;
        let mut n_f = f + df;

        while n_r >= 0 && n_r < 8 && n_f >= 0 && n_f < 8 {
            attacks |= 1 << (n_r * 8 + n_f);
            n_r += dr;
            n_f += df;
        }
        i += 1;
    }
    attacks
}

// This computes the array at compile time
pub const SQUARE_RAYS: [u64; 64] = {
    let mut table = [0; 64];
    let mut i = 0;
    while i < 64 {
        table[i] = get_queen_rays_inclusive(i);
        i += 1;
    }
    table
};

pub const RANK_3: u64 = 0x0000000000FF0000;
pub const RANK_4: u64 = 0x00000000FF000000;
pub const RANK_5: u64 = 0x000000FF00000000;
pub const RANK_6: u64 = 0x0000FF0000000000;
pub const RANK_2: u64 = 0x000000000000FF00;
pub const RANK_7: u64 = 0x00FF000000000000;
pub const RANK_8: u64 = 0xFF00000000000000;
pub const RANK_1: u64 = 0x00000000000000FF;
pub const FILE_A: u64 = 0x0101010101010101;
pub const FILE_B: u64 = 0x0202020202020202;
pub const FILE_C: u64 = 0x0404040404040404;
pub const FILE_D: u64 = 0x0808080808080808;
pub const FILE_E: u64 = 0x1010101010101010;
pub const FILE_F: u64 = 0x2020202020202020;
pub const FILE_G: u64 = 0x4040404040404040;
pub const FILE_H: u64 = 0x8080808080808080;

pub const FILES: [u64; 8] = [
    FILE_A, FILE_B, FILE_C, FILE_D, FILE_E, FILE_F, FILE_G, FILE_H,
];

pub const CENTER_SQUARES: u64 = 0x0000001818000000;
pub const EXTENDED_CENTER_SQUARES: u64 = 0x00003c3c00000000;

pub const KNIGHTS_BONUS: [f32; 64] = [
    -0.25, -0.20, -0.15, -0.15, -0.15, -0.15, -0.20, -0.25, // a1-h1
    -0.20, -0.10, 0.00, 0.00, 0.00, 0.00, -0.10, -0.20, // a2-h2
    -0.15, 0.00, 0.05, 0.075, 0.075, 0.05, 0.00, -0.15, // a3-h3
    -0.15, 0.025, 0.075, 0.10, 0.10, 0.075, 0.025, -0.15, // a4-h4
    -0.15, 0.00, 0.075, 0.10, 0.10, 0.075, 0.00, -0.15, // a5-h5
    -0.15, 0.025, 0.05, 0.075, 0.075, 0.05, 0.025, -0.15, // a6-h6
    -0.20, -0.10, 0.00, 0.025, 0.025, 0.00, -0.10, -0.20, // a7-h7
    -0.25, -0.20, -0.15, -0.15, -0.15, -0.15, -0.20, -0.25, // a8-h8
];

pub const BISHOPS_BONUS: [f32; 64] = [
    -0.10, -0.05, -0.05, -0.05, -0.05, -0.05, -0.05, -0.10, // a1-h1
    -0.05, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, -0.05, // a2-h2
    -0.05, 0.00, 0.05, 0.075, 0.075, 0.05, 0.00, -0.05, // a3-h3
    -0.05, 0.00, 0.075, 0.10, 0.10, 0.075, 0.00, -0.05, // a4-h4
    -0.05, 0.00, 0.075, 0.10, 0.10, 0.075, 0.00, -0.05, // a5-h5
    -0.05, 0.00, 0.05, 0.075, 0.075, 0.05, 0.00, -0.05, // a6-h6
    -0.05, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, -0.05, // a7-h7
    -0.10, -0.05, -0.05, -0.05, -0.05, -0.05, -0.05, -0.10, // a8-h8
];

pub const ROOK_BONUS: [f32; 64] = [
    0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, // a1-h1
    0.025, 0.025, 0.025, 0.025, 0.025, 0.025, 0.025, 0.025, // a2-h2
    0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, // a3-h3
    0.075, 0.075, 0.075, 0.075, 0.075, 0.075, 0.075, 0.075, // a4-h4
    0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10, // a5-h5
    0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, // a6-h6
    0.025, 0.025, 0.025, 0.025, 0.025, 0.025, 0.025, 0.025, // a7-h7
    0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, // a8-h8
];

pub const PAWNS_BONUS: [f32; 64] = [
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, // Rank 1 (Start)
    0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, // Rank 2
    0.1, 0.1, 0.2, 0.3, 0.3, 0.2, 0.1, 0.1, // Rank 3
    0.05, 0.05, 0.1, 0.25, 0.25, 0.1, 0.05, 0.05, // Rank 4
    0.0, 0.0, 0.0, 0.2, 0.2, 0.0, 0.0, 0.0, // Rank 5
    0.05, -0.05, -0.1, 0.0, 0.0, -0.1, -0.05, 0.05, // Rank 6
    0.05, 0.1, 0.1, -0.2, -0.2, 0.1, 0.1, 0.05, // Rank 7
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, // Rank 8
];

pub const QUEENS_BONUS: [f32; 64] = [
    -0.2, -0.1, -0.1, -0.05, -0.05, -0.1, -0.1, -0.2, -0.1, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.1,
    -0.1, 0.0, 0.05, 0.05, 0.05, 0.05, 0.0, -0.1, -0.05, 0.0, 0.05, 0.05, 0.05, 0.05, 0.0, -0.05,
    0.0, 0.0, 0.05, 0.05, 0.05, 0.05, 0.0, -0.05, -0.1, 0.05, 0.05, 0.05, 0.05, 0.05, 0.0, -0.1,
    -0.1, 0.0, 0.05, 0.0, 0.0, 0.0, 0.0, -0.1, -0.2, -0.1, -0.1, -0.05, -0.05, -0.1, -0.1, -0.2,
];

pub const KING_BONUS: [f32; 64] = [
    -0.3, -0.4, -0.4, -0.5, -0.5, -0.4, -0.4, -0.3, -0.3, -0.4, -0.4, -0.5, -0.5, -0.4, -0.4, -0.3,
    -0.3, -0.4, -0.4, -0.5, -0.5, -0.4, -0.4, -0.3, -0.3, -0.4, -0.4, -0.5, -0.5, -0.4, -0.4, -0.3,
    -0.2, -0.3, -0.3, -0.4, -0.4, -0.3, -0.3, -0.2, -0.1, -0.2, -0.2, -0.2, -0.2, -0.2, -0.2, -0.1,
    0.2, 0.2, 0.0, 0.0, 0.0, 0.0, 0.2, 0.2, 0.2, 0.3, 0.1, 0.0, 0.0, 0.1, 0.3, 0.2,
];

pub const MVV_LVA: [[i32; 6]; 6] = [
    // victim ↓ , attacker →
    //P   N   B   R   Q   K
    [105,104,103,102,101,100], // Pawn
    [205,204,203,202,201,200], // Knight
    [305,304,303,302,301,300], // Bishop
    [405,404,403,402,401,400], // Rook
    [505,504,503,502,501,500], // Queen
    [605,604,603,602,601,600], // King
];


pub fn get_book_moves(fen: &str) -> Option<&'static [&'static str]> {
    match fen {
        // ==================================================
        // START
        // ==================================================
        "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w" => Some(&[
            "e2e4",
            "d2d4",
        ]),

        // ==================================================
        // 1. e4
        // ==================================================

        // 1... e5
        "rnbqkbnr/pppp1ppp/8/4p3/4P3/8/PPPP1PPP/RNBQKBNR w" => Some(&[
            "g1f3",
        ]),

        // 1... c5 (Sicilian)
        "rnbqkbnr/pp1ppppp/8/2p5/4P3/8/PPPP1PPP/RNBQKBNR w" => Some(&[
            "g1f3",
            "d2d4",
        ]),

        // 1... e6 (French)
        "rnbqkbnr/pppppp1p/4p3/8/4P3/8/PPPP1PPP/RNBQKBNR w" => Some(&[
            "d2d4",
        ]),

        // 1... c6 (Caro-Kann)
        "rnbqkbnr/pp1ppppp/2p5/8/4P3/8/PPPP1PPP/RNBQKBNR w" => Some(&[
            "d2d4",
        ]),

        // ==================================================
        // e4 e5 mainlines
        // ==================================================

        // 1.e4 e5 2.Nf3
        "rnbqkbnr/pppp1ppp/8/4p3/4P3/5N2/PPPP1PPP/RNBQKB1R b" => Some(&[
            "b8c6",
            "g8f6",
        ]),

        // 1.e4 e5 2.Nf3 Nc6
        "r1bqkbnr/pppp1ppp/2n5/4p3/4P3/5N2/PPPP1PPP/RNBQKB1R w" => Some(&[
            "f1b5",
            "f1c4",
        ]),

        // Ruy Lopez
        "r1bqkbnr/pppp1ppp/2n5/1B2p3/4P3/5N2/PPPP1PPP/RNBQK2R b" => Some(&[
            "a7a6",
        ]),

        // Ruy Lopez main
        "r1bqkbnr/1ppp1ppp/p1n5/1B2p3/4P3/5N2/PPPP1PPP/RNBQK2R w" => Some(&[
            "b5a4",
        ]),

        // Italian Game
        "r1bqkbnr/pppp1ppp/2n5/4p3/2B1P3/5N2/PPPP1PPP/RNBQK2R b" => Some(&[
            "f8c5",
            "g8f6",
        ]),

        // ==================================================
        // Sicilian mainline
        // ==================================================

        // 1.e4 c5 2.Nf3
        "rnbqkbnr/pp1ppppp/8/2p5/4P3/5N2/PPPP1PPP/RNBQKB1R b" => Some(&[
            "d7d6",
            "b8c6",
        ]),

        // 1.e4 c5 2.d4
        "rnbqkbnr/pp1ppppp/8/2p5/3PP3/8/PPP2PPP/RNBQKBNR b" => Some(&[
            "c5d4",
        ]),

        // Open Sicilian
        "rnbqkbnr/pp1ppppp/8/8/3pP3/5N2/PPP2PPP/RNBQKB1R b" => Some(&[
            "b8c6",
        ]),

        // ==================================================
        // 1. d4
        // ==================================================

        // 1... d5
        "rnbqkbnr/ppp1pppp/8/3p4/3P4/8/PPP1PPPP/RNBQKBNR w" => Some(&[
            "c2c4",
            "g1f3",
        ]),

        // 1... Nf6
        "rnbqkb1r/pppppppp/5n2/8/3P4/8/PPP1PPPP/RNBQKBNR w" => Some(&[
            "c2c4",
        ]),

        // ==================================================
        // Queen’s Gambit
        // ==================================================

        // 1.d4 d5 2.c4
        "rnbqkbnr/ppp1pppp/8/3p4/2PP4/8/PP2PPPP/RNBQKBNR b" => Some(&[
            "e7e6",
            "c7c6",
        ]),

        // QGD
        "rnbqkbnr/ppp1pppp/4p3/3p4/2PP4/8/PP2PPPP/RNBQKBNR w" => Some(&[
            "b1c3",
            "g1f3",
        ]),

        // Slav
        "rnbqkbnr/pp2pppp/2p5/3p4/2PP4/8/PP2PPPP/RNBQKBNR w" => Some(&[
            "g1f3",
        ]),

        // ==================================================
        // Indian defenses
        // ==================================================

        // 1.d4 Nf6 2.c4
        "rnbqkb1r/pppppppp/5n2/8/2PP4/8/PP2PPPP/RNBQKBNR b" => Some(&[
            "g7g6",
            "e7e6",
        ]),

        // King’s Indian
        "rnbqkb1r/pppppp1p/5n2/8/2PP4/8/PP2PPPP/RNBQKBNR w" => Some(&[
            "b1c3",
            "g1f3",
        ]),

        // ==================================================
        // End of book
        // ==================================================
        _ => None,
    }
}
